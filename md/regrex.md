

# 一、PCRE  

## (一)、文档

>PHP Manual -> 函数参考 -> 文本处理 -> PCRE -> PCRE模式 -> 语法
>

## (二)、函数

>| preg_filter                 | 执行一个正则表达式搜索和替换                                 |
>| --------------------------- | ------------------------------------------------------------ |
>| preg_grep                   | 返回匹配模式的数组条目                                       |
>| preg_last_error             | 返回最后一个PCRE正则执行产生的错误代码                       |
>| preg_match_all              | 执行一个全局正则表达式匹配                                   |
>| preg_match                  | 执行匹配正则表达式                                           |
>| preg_quote                  | 转义正则表达式字符                                           |
>| preg_replace_callback_array | Perform a regular expression search and replace using callbacks |
>| preg_replace_callback       | 执行一个正则表达式搜索并且使用一个回调进行替换               |
>| preg_replace                | 执行一个正则表达式的搜索和替换                               |
>| preg_split                  | 通过一个正则表达式分隔字符串                                 |
>| preg_replace_callback_array | Perform a regular expression search and replace using callbacks |
>| preg_replace_callback       | 执行一个正则表达式搜索并且使用一个回调进行替换               |
>| preg_replace                | 执行一个正则表达式的搜索和替换                               |
>| preg_split                  | 通过一个正则表达式分隔字符串                                 |

#### preg_quote

>## 分隔符
>
>  当使用 PCRE 函数的时候，模式需要由*分隔符*闭合包裹。分隔符可以使任意非字母数字、非反斜线、非空白字符。   
>
>  经常使用的分隔符是正斜线(*/*)、hash符号(*#*)   以及取反符号(*~*)。下面的例子都是使用合法分隔符的模式。    
>
>```
>/foo bar/
>#^[^0-9]$#
>+php+
>%[a-zA-Z0-9_-]%
>```
>
>
>
>如果分隔符需要在模式内进行匹配，它必须使用反斜线进行转义。如果分隔符经常在  模式内出现， 一个更好的选择就是是用其他分隔符来提高可读性。    
>
>```
>/http:\/\//
>#http://#
>```
>
>需要将一个字符串放入模式中使用时，可以用 [preg_quote()](mk:@MSITStore:C:\Users\EDZ\Desktop\php74_zh(2020).chm::/res/function.preg-quote.html) 函数对其进行   转义，它的第二个参数(可选)可以用于指定需要被转义的分隔符。   
>
>
>
>  除了上面提到的分隔符，也可以使用括号样式的分隔符，左括号和右括号分别作为开始和结束  分隔符。

## (三)、语法

### 1、注释

### 2、分隔符与模式修饰符

#### (1)、分隔符

>文档：【PHP Manual -> 函数参考 -> 文本处理 -> PCRE -> 简介】
>
>
>
>***表达式必须用分隔符闭合***
>
>比如一个正斜杠(/)。 
>
>* 分隔符可以使任意非字母数字、非反斜线、非空白字符。
>
>* 如果分隔符  在表达式中使用，需要使用反斜线进行转义。
>* 自php 4.0.4开始，可以使用 perl 样式的()、 {}、    [] 以及 <> 作为分隔符
>* 结束分隔符后面可以紧跟模式修饰符来影响匹配效果
>* preg_quote函数
>* * 需要将一个字符串放入模式中使用时，可以用 [preg_quote()](mk:@MSITStore:C:\Users\EDZ\Desktop\php74_zh(2020).chm::/res/function.preg-quote.html) 函数对其进行   转义，它的第二个参数(可选)可以用于指定需要被转义的分隔符。
>
>```php
>$str = "a.b?cd-efg1(23456}7\89/";
>$preg = "a";
>var_dump(preg_match($preg,$str));
>
>/**PHP Warning 'yii\base\ErrorException' with message 'preg_match(): Delimiter must not be alphanumeric or backslash'(分隔符不能是字母数字或反斜杠)**/
>```
>
>

#### (2)、模式修饰符

>文档：【PHP Manual -> 函数参考 -> 文本处理 -> PCRE -> 模式修饰符】
>
>| 修饰符 | 功能       | 3    |
>| ------ | ---------- | ---- |
>| i      | 忽略大小写 |      |
>| m      |            |      |
>| s      |            |      |
>| x      |            |      |
>| e      |            |      |

### 3、关键字符(元字符)

>文档：【PHP Manual -> 函数参考 -> 文本处理 -> PCRE -> PCRE模式 -> 模式语法 -> 元字符】
>
> 
>
>`加*减-乘*除/`
>
>`[]（）`
>
>| 位置     |      | 字符 | 含义                                                         | 备注       |
>| -------- | ---- | ---- | ------------------------------------------------------------ | ---------- |
>| 方括号外 | 1    | `\`  | 一般用于转义字符                                             |            |
>|          | 2    | `^`  | 断言目标的开始位置(或在多行模式下是行首)                     |            |
>|          | 3    | `$`  | 断言目标的结束位置(或在多行模式下是行尾)                     |            |
>|          | 4    | `.`  | 匹配除换行符外的任何字符(默认)                               | 点号(en)   |
>|          | 5    | `[`  | 开始字符类定义                                               |            |
>|          | 6    | `]`  | 结束字符类定义                                               |            |
>|          | 7    | `|`  | 开始一个可选分支                                             |            |
>|          | 8    | `(`  | 子组的开始标记                                               |            |
>|          | 9    | `)`  | 子组的结束标记                                               |            |
>|          | 10   | `?`  | 作为量词，表示 0 次或 1 次匹配。位于量词后面用于改变量词的贪婪特性 |            |
>|          | 11   | `*`  | 量词，0 次或多次匹配                                         |            |
>|          | 12   | `+`  | 量词，1 次或多次匹配                                         |            |
>|          | 13   | `{`  | 自定义量词开始标记                                           |            |
>|          | 14   | `}`  | 自定义量词结束标记                                           |            |
>| 方括号内 | 1    | `\`  | 转义字符                                                     |            |
>|          | 2    | `^`  | 仅在作为第一个字符(方括号内)时，表明字符类取反               |            |
>|          | 3    | `-`  | 标记字符范围                                                 | 中横线(en) |
>
>```php
>$str = "a.b?cd-efg1(23456}7\89/";
>$preg = "/(/";
>var_dump(preg_match($preg,$str));
>/***
>PHP Warning 'yii\base\ErrorException' with message 'preg_match(): Compilation failed: missing closing parenthesis at offset 1(编译失败：偏移量1处缺少右括号)
>*/
>------------------------------------------------------------------------
>$preg = "/\(/";
>var_dump(preg_match($preg,$str));
>/**结果：1    **/
>------------------------------------------------------------------------
>$preg = "/./";
>var_dump(preg_match($preg,$str));
>/**结果：1   这个匹配得不是.字符。而是除换行符之外得所有字符 **/
>------------------------------------------------------------------------
>$preg = "/-/";
>var_dump(preg_match($preg,$str));    
>/**结果：1    **/
>------------------------------------------------------------------------
>$preg = "/[-]/";
>var_dump(preg_match($preg,$str));
>/**结果：1     **/
>------------------------------------------------------------------------
>$preg = "/[1-]/";
>var_dump(preg_match($preg,$str));
>/**结果：1     **/
>------------------------------------------------------------------------
>$preg = "///";
>var_dump(preg_match($preg,$str));
>/**结果：PHP Warning 'yii\base\ErrorException' with message 'preg_match(): Unknown modifier '/'' (错误得修饰符/。它把第二个/当作结束了。第三个当作修饰符了)     **/
>------------------------------------------------------------------------
>
>```
>
>



### 4、字符

#### (1)、转义关键字符(元字符)

>如果紧接着是一个非字母数字字符，表明取消  该字符所代表的特殊涵义。
>
>这种将反斜线作为转义字符的用法在字符类 内部和外部都可用
>
>```php
>$str = "a.b?c^d-efg1(23456}7\89/";
>$preg = "/^/";
>var_dump(preg_match($preg,$str));
>/**结果：1  因为^没有在开始位置，只是普通字符**/
>$preg = "/\^/";
>var_dump(preg_match($preg,$str));
>/**结果：1  因为^没有在开始位置，只是普通字符。但使用转义字符也不会出错。也表达了转义**/
>```

#### (1)、字符集

> | 序号 | 字符     | 含义                              | 备注               |
> | ---- | -------- | --------------------------------- | ------------------ |
> |      | `\a`     | 响铃字符(十六进制 07)             |                    |
> |      | `\cx`    | "control-x"，x 是任意字符         |                    |
> |      | `\e`     | 转义 (十六进制 1B)                |                    |
> |      | `\f`     | 换页 (十六进制 0C)                |                    |
> |      | `\n`     | 换行 (十六进制 0A)                |                    |
> |      | `\p{xx}` | 一个符合 xx 属性的字符            | unicode properties |
> |      | `\P{xx}` | 一个不符合xx属性的字符            | unicode properties |
> |      | `\r`     | 回车 (十六进制 0D)                |                    |
> |      | `\t`     | 水平制表符 (十六进制 09)          |                    |
> |      | `\xhh`   | hh十六进制编码的字符              | unicode properties |
> |      | `\ddd`   | ddd八进制编码的字符，或者后向引用 |                    |
> |      | ``       |                                   |                    |
> |      | ``       |                                   |                    |
> |      | ``       |                                   |                    |
> |      | ``       |                                   |                    |
> |      | ``       |                                   |                    |
>
> 

#### (2)、转义字符

### 、匹配次数

### 、字符边界

### 、替换语法

### 、分组

### 、反向引用

### 、预搜索



# POSIX regex(php7已移除)

## 函数



## 表达式全集

|     字符     |                             描述                             |
| :----------: | :----------------------------------------------------------: |
|      \       | 将下一个字符标记为一个特殊字符、或一个原义字符、或一个向后引用、或一个八进制转义符。例如，“`n`”匹配字符“`n`”。“`\n`”匹配一个换行符。串行“`\\`”匹配“`\`”而“`\(`”则匹配“`(`”。 |
|      ^       | 匹配输入字符串的开始位置。如果设置了RegExp对象的Multiline属性，^也匹配“`\n`”或“`\r`”之后的位置。 |
|      $       | 匹配输入字符串的结束位置。如果设置了RegExp对象的Multiline属性，$也匹配“`\n`”或“`\r`”之前的位置。 |
|      *       | 匹配前面的子表达式零次或多次。例如，zo*能匹配“`z`”以及“`zoo`”。*等价于{0,}。 |
|      +       | 匹配前面的子表达式一次或多次。例如，“`zo+`”能匹配“`zo`”以及“`zoo`”，但不能匹配“`z`”。+等价于{1,}。 |
|      ?       | 匹配前面的子表达式零次或一次。例如，“`do(es)?`”可以匹配“`does`”或“`does`”中的“`do`”。?等价于{0,1}。 |
|    {*n*}     | *n*是一个非负整数。匹配确定的*n*次。例如，“`o{2}`”不能匹配“`Bob`”中的“`o`”，但是能匹配“`food`”中的两个o。 |
|    {*n*,}    | *n*是一个非负整数。至少匹配*n*次。例如，“`o{2,}`”不能匹配“`Bob`”中的“`o`”，但能匹配“`foooood`”中的所有o。“`o{1,}`”等价于“`o+`”。“`o{0,}`”则等价于“`o*`”。 |
|  {*n*,*m*}   | *m*和*n*均为非负整数，其中*n*<=*m*。最少匹配*n*次且最多匹配*m*次。例如，“`o{1,3}`”将匹配“`fooooood`”中的前三个o。“`o{0,1}`”等价于“`o?`”。请注意在逗号和两个数之间不能有空格。 |
|      ?       | 当该字符紧跟在任何一个其他限制符（*,+,?，{*n*}，{*n*,}，{*n*,*m*}）后面时，匹配模式是非贪婪的。非贪婪模式尽可能少的匹配所搜索的字符串，而默认的贪婪模式则尽可能多的匹配所搜索的字符串。例如，对于字符串“`oooo`”，“`o+?`”将匹配单个“`o`”，而“`o+`”将匹配所有“`o`”。 |
|      .       | 匹配除“`\`*`n`*”之外的任何单个字符。要匹配包括“`\`*`n`*”在内的任何字符，请使用像“`(.|\n)`”的模式。 |
|  (pattern)   | 匹配pattern并获取这一匹配。所获取的匹配可以从产生的Matches集合得到，在VBScript中使用SubMatches集合，在JScript中则使用$0…$9属性。要匹配圆括号字符，请使用“`\(`”或“`\)`”。 |
| (?:pattern)  | 匹配pattern但不获取匹配结果，也就是说这是一个非获取匹配，不进行存储供以后使用。这在使用或字符“`(|)`”来组合一个模式的各个部分是很有用。例如“`industr(?:y|ies)`”就是一个比“`industry|industries`”更简略的表达式。 |
| (?=pattern)  | 正向肯定预查，在任何匹配pattern的字符串开始处匹配查找字符串。这是一个非获取匹配，也就是说，该匹配不需要获取供以后使用。例如，“`Windows(?=95|98|NT|2000)`”能匹配“`Windows2000`”中的“`Windows`”，但不能匹配“`Windows3.1`”中的“`Windows`”。预查不消耗字符，也就是说，在一个匹配发生后，在最后一次匹配之后立即开始下一次匹配的搜索，而不是从包含预查的字符之后开始。 |
| (?!pattern)  | 正向否定预查，在任何不匹配pattern的字符串开始处匹配查找字符串。这是一个非获取匹配，也就是说，该匹配不需要获取供以后使用。例如“`Windows(?!95|98|NT|2000)`”能匹配“`Windows3.1`”中的“`Windows`”，但不能匹配“`Windows2000`”中的“`Windows`”。预查不消耗字符，也就是说，在一个匹配发生后，在最后一次匹配之后立即开始下一次匹配的搜索，而不是从包含预查的字符之后开始 |
| (?<=pattern) | 反向肯定预查，与正向肯定预查类拟，只是方向相反。例如，“`(?<=95|98|NT|2000)Windows`”能匹配“`2000Windows`”中的“`Windows`”，但不能匹配“`3.1Windows`”中的“`Windows`”。 |
| (?<!pattern) | 反向否定预查，与正向否定预查类拟，只是方向相反。例如“`(?<!95|98|NT|2000)Windows`”能匹配“`3.1Windows`”中的“`Windows`”，但不能匹配“`2000Windows`”中的“`Windows`”。 |
|     x\|y     | 匹配x或y。例如，“`z|food`”能匹配“`z`”或“`food`”。“`(z|f)ood`”则匹配“`zood`”或“`food`”。 |
|    [xyz]     | 字符集合。匹配所包含的任意一个字符。例如，“`[abc]`”可以匹配“`plain`”中的“`a`”。 |
|    [^xyz]    | 负值字符集合。匹配未包含的任意字符。例如，“`[^abc]`”可以匹配“`plain`”中的“`p`”。 |
|    [a-z]     | 字符范围。匹配指定范围内的任意字符。例如，“`[a-z]`”可以匹配“`a`”到“`z`”范围内的任意小写字母字符。 |
|    [^a-z]    | 负值字符范围。匹配任何不在指定范围内的任意字符。例如，“`[^a-z]`”可以匹配任何不在“`a`”到“`z`”范围内的任意字符。 |
|      \b      | 匹配一个单词边界，也就是指单词和空格间的位置。例如，“`er\b`”可以匹配“`never`”中的“`er`”，但不能匹配“`verb`”中的“`er`”。 |
|      \B      | 匹配非单词边界。“`er\B`”能匹配“`verb`”中的“`er`”，但不能匹配“`never`”中的“`er`”。 |
|     \cx      | 匹配由x指明的控制字符。例如，\cM匹配一个Control-M或回车符。x的值必须为A-Z或a-z之一。否则，将c视为一个原义的“`c`”字符。 |
|      \d      |               匹配一个数字字符。等价于[0-9]。                |
|      \D      |              匹配一个非数字字符。等价于[^0-9]。              |
|      \f      |              匹配一个换页符。等价于\x0c和\cL。               |
|      \n      |              匹配一个换行符。等价于\x0a和\cJ。               |
|      \r      |              匹配一个回车符。等价于\x0d和\cM。               |
|      \s      | 匹配任何空白字符，包括空格、制表符、换页符等等。等价于[ \f\n\r\t\v]。 |
|      \S      |          匹配任何非空白字符。等价于[^ \f\n\r\t\v]。          |
|      \t      |              匹配一个制表符。等价于\x09和\cI。               |
|      \v      |            匹配一个垂直制表符。等价于\x0b和\cK。             |
|      \w      |    匹配包括下划线的任何单词字符。等价于“`[A-Za-z0-9_]`”。    |
|      \W      |        匹配任何非单词字符。等价于“`[^A-Za-z0-9_]`”。         |
|    \x*n*     | 匹配*n*，其中*n*为十六进制转义值。十六进制转义值必须为确定的两个数字长。例如，“`\x41`”匹配“`A`”。“`\x041`”则等价于“`\x04&1`”。正则表达式中可以使用ASCII编码。. |
|     \num     | 匹配*num*，其中*num*是一个正整数。对所获取的匹配的引用。例如，“`(.)\1`”匹配两个连续的相同字符。 |
|      \n      | 标识一个八进制转义值或一个向后引用。如果\*n*之前至少*n*个获取的子表达式，则*n*为向后引用。否则，如果*n*为八进制数字（0-7），则*n*为一个八进制转义值。 |
|     \nm      | 标识一个八进制转义值或一个向后引用。如果\*nm*之前至少有*nm*个获得子表达式，则*nm*为向后引用。如果\*nm*之前至少有*n*个获取，则*n*为一个后跟文字*m*的向后引用。如果前面的条件都不满足，若*n*和*m*均为八进制数字（0-7），则\nm*将匹配八进制转义值*nm。 |
|     \nml     | 如果*n*为八进制数字（0-3），且*m和l*均为八进制数字（0-7），则匹配八进制转义值*nm*l。 |
|    \u*n*     | 匹配*n*，其中*n*是一个用四个十六进制数字表示的Unicode字符。例如，\u00A9匹配版权符号（©）。 |







## 常用正则表达式

|         用户名          | `/^[a-z0-9_-]{3,16}$/`                                       |
| :---------------------: | ------------------------------------------------------------ |
|          密码           | `/^[a-z0-9_-]{6,18}$/`                                       |
|       十六进制值        | `/^#?([a-f0-9]{6}|[a-f0-9]{3})$/`                            |
|        电子邮箱         | `/^([a-z0-9_\.-]+)@([\da-z\.-]+)\.([a-z\.]{2,6})$/`<br>`/^[a-z\d]+(\.[a-z\d]+)*@([\da-z](-[\da-z])?)+(\.{1,2}[a-z]+)+$/` |
|           URL           | `/^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/` |
|         IP 地址         | `/((2[0-4]\d|25[0-5]|[01]?\d\d?)\.){3}(2[0-4]\d|25[0-5]|[01]?\d\d?)/`<br>`/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/` |
|        HTML 标签        | `/^<([a-z]+)([^<]+)*(?:>(.*)<\/\1>|\s+\/>)$/`                |
|     删除代码\\注释      | `(?<!http:|\S)//.*$`                                         |
| Unicode编码中的汉字范围 | `/^[\u2E80-\u9FFF]+$/`                                       |